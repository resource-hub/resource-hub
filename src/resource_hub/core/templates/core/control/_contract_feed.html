{% load i18n %}
{% load sekizai_tags %}

<div id="feed-loader" class="ui active centered inline loader"></div>
<div id="contract-feed" class="ui stackable three column cards grid"></div>


{% addtoblock 'js' %}
<script id="template" type="text/template">
    <div class="column">
        <a id='card' class="ui fluid card" href="%link%">
            <div class="ui %state% top attached label">%state_display%</div>
            <!-- <div class="content">
                <img class="ui avatar image" src="%creditor_thumbnail%"> %creditor_name%
            </div> -->
            <div class="content">
                <div class="header">%type_name%</div>
                <div class="meta">
                    <span class="date">{% trans 'created at' %} %created_at%</span>
                </div>
            </div>
        </a>
    </div>
</script>
<script>
    function create_feed(name = null, id = null) {
        var template = document.getElementById("template");
        var templateHtml = template.innerHTML;

        $.ajax({
            url: "{% url 'api:contracts_list' %}",
            type: 'GET',
            dataType: 'JSON',
            data: '&type=' + '{{ type }}'
        }).done(function (data) {
            var feed = "";

            $.each(data.results, function (i, contract) {
                feed += templateHtml
                    .replace(/%type_name%/g, contract['type_name'])
                    .replace(/%state%/g, contract['state'])
                    .replace(/%state_display%/g, contract['state_display'])
                    .replace(/%link%/g, contract['link'])
                    .replace(/%created_at%/g, contract['created_at'])
                    .replace(/%creditor_name%/g, contract.creditor['name'])
                    .replace(/%creditor_thumbnail%/g, contract.creditor['thumbnail'])
            });

            remove_loader('#feed-loader');
            $('#contract-feed').html(feed);
            $('.thumbnail').on('load', function () {
                $('.placeholder').hide();
            });
        });

    }
    $(document).ready(function () {
        create_feed();
    })
</script>
{% endaddtoblock %}